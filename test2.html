<html>
  <body>

    <script>
        window.alert(
            "Due to an apparent bug in the Xbox Edge browser, focus is lost when the \"View\" button is pressed. This dialog is being displayed as an attempt to restore focus.\n\n" +
            "Please use the alternate buttons for \"Select\", \"Start\", and \"Show Pause Dialog\" actions. (see \"Xbox Series X|S Platform\" section in the webRcade documentation).\n\n" +
            "https://docs.webrcade.com/platforms/xbox\n(\"Alternate controls\" section)\n\n" +
            "Press the \"B\" button to continue."
        );
    </script>


    <form>
        <button id="input1" type="button">Focus</button>
    </form>
      
    <div id='output'></div>

    <dialog id="myDialog">This is an open dialog window</dialog>

    <script>
        const addText = (text) =>  {                  
            document.getElementById('output').innerHTML += "<div>" + text + "</div>";    
        }

        document.addEventListener("visibilitychange", function() {
            if (document.hidden){
                addText("Browser tab is hidden")
            } else {
                addText("Browser tab is visible")
            }
        });

        window.onblur = (e) => {
            e.preventDefault();            
            addText("Window blur");
            addText(document.activeElement);
            // setTimeout (() => {
            //     alert('lost focus');
            //     window.focus();
            // }, 10);
        }

        const pollGamepads = () => {
            let gamepads = navigator.getGamepads ? navigator.getGamepads() : (navigator.webkitGetGamepads ? navigator.webkitGetGamepads : []);
            for (let i = 0; i < gamepads.length; i++) {
                let gp = gamepads[i];
                if (gp) {
                    for (let j = 0; j < gp.buttons.length; j++) {
                        if (gp.buttons[j].pressed) {
                            addText('Button pressed: ' + j);
                            if (!document.hasFocus()) {           
                                window.focus();                                
                                addText("lostFocus");    
                                //                         window.alert('lost focus');                            
                            }                            
                        }
                    }
                }            
            }                
        }

        setInterval(pollGamepads, 500);

        document.addEventListener('keydown', (e) => {
            //e.preventDefault();
            //e.stopPropagation();
            window.focus();                                
            addText('keydown: ' + e.keyCode);

            if (e.keyCode === 208) {
                setTimeout(() => {
                    if (!document.hasFocus()) {
                        window.alert('test');
                    }
                }, 100);
            }
        });
        document.addEventListener('keyup', (e) => {
            //e.preventDefault();
            //e.stopPropagation();
            window.focus();                                
            addText('keyup:  ' + e.keyCode);
            return false;
        });
        document.addEventListener('keypress', (e) => {
            //e.preventDefault();
            //e.stopPropagation();            
            window.focus();                                
            addText('keypress:  ' + e.keyCode);
            return false;
        });


        setTimeout(() => {
            document.getElementById("input1").focus();
        }, 100);

        addText(navigator.vendorSub);
        addText(navigator.appVersion);
        addText(navigator.platform);        
        addText(navigator.product);
        addText(navigator.userAgentData);
        for (var i = 0; i < navigator.plugins.length; i++) {
            addText(navigator.plugins[i].name);
        }    

        document.onfullscreenchange = function ( event ) {
            addText("FULL SCREEN CHANGE")
        };        
        
    </script>
  </body>
</html>